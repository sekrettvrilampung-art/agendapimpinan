<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Agenda Pimpinan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    .overlay {
      background-color: rgba(0,0,0,0.6); /* overlay gelap */
      min-height: 100vh;
      padding: 24px;
      color: white;
    }
  </style>
</head>
<body class="bg-cover bg-center" style="background-image: url('foto-kantor.jpg');">
  <div class="overlay">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <div class="flex items-center gap-4">
        <img src="logo.png" alt="Logo" class="h-14 w-14 rounded bg-white p-1 shadow-md"/>
        <h1 class="text-4xl font-bold">Agenda Pimpinan</h1>
      </div>
      <div id="clock" class="text-xl"></div>
    </div>

    <!-- Highlight hari ini -->
    <div id="highlight" class="mb-6"></div>

    <!-- List Agenda -->
    <div id="agenda" class="space-y-4"></div>

    <!-- Footer brand -->
    <div class="mt-8 text-center text-sm text-gray-300">
      TVRI Lampung â€“ Digital Signage
    </div>
  </div>

  <script>
    const apiKey = "AIzaSyB-EXtF86wkHM6ZwzGZ3JO2BhA8Wwi8xKI"; // isi API key lu
    const calendarId = "sekret.tvrilampung@gmail.com"; // isi Calendar ID lu
    const maxResults = 10;

    // Kategori warna
    function getCategoryColor(title) {
      if (title.includes("[Penting]")) return "bg-red-600";
      if (title.includes("[Eksternal]")) return "bg-blue-600";
      if (title.includes("[Rutin]")) return "bg-green-600";
      return "bg-slate-700";
    }

    // Clock realtime
    function updateClock() {
      const now = new Date();
      document.getElementById("clock").innerText =
        now.toLocaleString("id-ID", { weekday:"long", year:"numeric", month:"long", day:"numeric", hour:"2-digit", minute:"2-digit" });
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Ambil data event
    async function loadEvents() {
      const url = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?key=${apiKey}&singleEvents=true&orderBy=startTime&timeMin=${new Date().toISOString()}&maxResults=${maxResults}`;
      const res = await fetch(url);
      const data = await res.json();

      const agenda = document.getElementById("agenda");
      const highlight = document.getElementById("highlight");
      agenda.innerHTML = "";
      highlight.innerHTML = "";

      if (data.items && data.items.length > 0) {
        data.items.forEach(ev => {
          const start = ev.start.dateTime || ev.start.date;
          const end = ev.end.dateTime || ev.end.date;
          const date = new Date(start);
          const dateEnd = new Date(end);
          const now = new Date();

          const timeStr = date.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}) +
                          " - " +
                          dateEnd.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"});

          const colorClass = getCategoryColor(ev.summary || "");

          const card = `
            <div class="p-5 rounded-xl shadow-md ${colorClass}">
              <div class="text-sm">${date.toLocaleDateString("id-ID",{weekday:"long", day:"numeric", month:"long"})}</div>
              <div class="text-xl font-bold">${ev.summary || "(Tanpa Judul)"}</div>
              <div class="text-sm">${timeStr}</div>
            </div>
          `;

          // Highlight event hari ini
          if (date.toDateString() === now.toDateString()) {
            if (date > now) {
              const diffMin = Math.floor((date - now) / 60000);
              highlight.innerHTML = `
                <div class="p-6 rounded-xl bg-yellow-500 text-black shadow-md">
                  <div class="text-2xl font-bold">Agenda Selanjutnya</div>
                  <div class="text-lg">${ev.summary}</div>
                  <div class="mt-2">Dimulai dalam ${diffMin} menit</div>
                </div>
              `;
            } else if (date <= now && dateEnd >= now) {
              highlight.innerHTML = `
                <div class="p-6 rounded-xl bg-green-400 text-black shadow-md">
                  <div class="text-2xl font-bold">Sedang Berlangsung</div>
                  <div class="text-lg">${ev.summary}</div>
                  <div class="mt-2">Hingga ${dateEnd.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}</div>
                </div>
              `;
            }
          }

          agenda.innerHTML += card;
        });
      } else {
        agenda.innerHTML = "<p class='text-center text-gray-400'>Tidak ada agenda.</p>";
      }
    }

    loadEvents();
    setInterval(loadEvents, 60000);
  </script>
</body>
</html>
